---
title: "HW2"
output: github_document
date: "2024-09-26"
---

```{r setup, include=FALSE}

library(tidyverse) #read csv
library(readxl) #read excel
library(haven) #read SAS
library(dplyr)
```

## Problem 1

```{r include=FALSE}
transit_df = 
  read.csv("Data_Imports/NYC_Transit_Subway_Entrance_And_Exit_Data.csv", na = c(".", "NA", "")) %>% 
  janitor::clean_names() %>% 
  select(line:entry, vending, ada) %>% 
  mutate(
    entry = case_match(
      entry,
      "YES" ~ TRUE,
      "NO" ~ FALSE
  )
) 
```
After cleaning the initial NYC transit dataset, the resulting dataset is described by **`r ncol(transit_df)`** variables, which are: **`r colnames(transit_df)`**. This dataset is **`r nrow(transit_df)`** rows by **`r ncol(transit_df)`** columns. The initial cleaning steps included changing column names to make sure they were all formatted the same way (in snake_case), removing certain columns not necessary for data analysis, and converting the data points under the entry column into logical variables. Because the routes are all separated into different columns, this data isn't tidy. To tidy, the data set would contain one column that held the information for route number and another column that held the information on whether there was a train that followed that route at each location.

```{r include=FALSE}
line_station_df = 
  transit_df %>% 
  mutate(line_station = paste(line, station_name, sep= " ")) %>% 
  distinct(line_station, .keep_all = TRUE)
```

```{r include=FALSE}
ada_compliant_df = 
  line_station_df %>% 
  filter(ada == TRUE)
```

```{r include=FALSE}
no_vending_df = 
  line_station_df %>% 
  filter(vending == "NO")

entrance_no_vending_df =
  no_vending_df %>% 
  filter(entry == TRUE)

prop_entrance_no_vending = nrow(entrance_no_vending_df) / nrow(no_vending_df)
```

```{r include=FALSE}
transit_tidy_A_df = 
  transit_df %>% 
  mutate(across(c(route1:route11), as.character)) %>% 
  pivot_longer(
    route1:route11,
    names_to = "routes", 
    values_to = "trains") %>% 
  mutate(line_station = paste(line, station_name, sep= " ")) %>% 
  distinct(line_station, .keep_all = TRUE) %>% 
  filter(trains == "A")

transit_tidy_ada_df = 
  transit_tidy_A_df %>% 
  filter(ada == TRUE)
```

There are **`r nrow(line_station_df)`** distinct stations.

There are **`r nrow(ada_compliant_df)`**  ADA compliant stations.

The proportion of stations with no vending that allow entry is **`r prop_entrance_no_vending`**

There are **`r nrow(transit_tidy_A_df)`** distinct stations that serve the A train. Of these stations, **`r nrow(transit_tidy_ada_df)`** are ADA compliant

## Problem 2

```{r include=FALSE}
mr_trash_df = 
  read_excel("Data_Imports/202309_Trash_Wheel_Collection_Data.xlsx", 
             sheet = "Mr. Trash Wheel",
             range = "A2:N586",
             na = c(".", "NA", ""),
             ) %>% 
  janitor::clean_names() %>% 
  mutate(
    vessel_name = "Mr. Trash Wheel",
    sports_balls = as.integer(round(sports_balls)),
    year = as.double(year)
    ) %>% 
  relocate(vessel_name)
```

```{r include=FALSE}
prof_trash_df = 
  read_excel("Data_Imports/202309_Trash_Wheel_Collection_Data.xlsx", 
             sheet = "Professor Trash Wheel",
             range = "A2:M108",
             na = c(".", "NA", ""),
             ) %>% 
  janitor::clean_names()%>% 
  mutate(
    vessel_name = "Professor Trash Wheel",
    sports_balls = "",
    sports_balls = as.integer(sports_balls)
    )%>% 
  relocate(vessel_name, 1:12, sports_balls)
```

```{r include=FALSE}
gwynnda_trash_df = 
  read_excel("Data_Imports/202309_Trash_Wheel_Collection_Data.xlsx", 
             sheet = "Gwynnda Trash Wheel",
             range = "A2:L157",
             na = c(".", "NA", ""),
             ) %>% 
  janitor::clean_names()%>% 
  mutate(
    vessel_name = "Gwynnda Trash Wheel",
    sports_balls = "",
    glass_bottles = "",
    sports_balls = as.integer(sports_balls),
    glass_bottles = as.double(glass_bottles)
    )%>% 
  relocate(vessel_name, 1:9, glass_bottles, 10:11, sports_balls)

```

```{r include=FALSE}
combined_trash_df = bind_rows(mr_trash_df, prof_trash_df, gwynnda_trash_df)
```


## Problem 3
```{r}
bakers_df = 
  read.csv("Data_Imports/gbb_datasets/bakers.csv", na = c(".", "NA", "", "N/A")) %>% 
  janitor::clean_names() %>% 
  arrange(series) %>% 
  separate(baker_name, into = c("baker_first_name", "baker_last_name"), sep = " ")
  

bakes_df = 
  read.csv("Data_Imports/gbb_datasets/bakes.csv", na = c(".", "NA", "", "N/A")) %>% 
  janitor::clean_names() %>% 
  mutate(baker = ifelse(baker == '"Jo"', "Jo", baker)) %>% 
  rename(baker_first_name = baker) 
  

results_df = 
  read.csv("Data_Imports/gbb_datasets/results.csv", na = c(".", "NA", "", "N/A"), 
          skip = 3,
          header = FALSE, 
          col.names = c("series", "episode", "baker", "technical", "result")) %>% 
  mutate(baker = ifelse(baker == "Joanne", "Jo", baker)) %>% 
  rename(baker_first_name = baker)
  
gbb_half_df = left_join(results_df, bakes_df, 
                        by = c("baker_first_name"="baker_first_name", "series"="series", "episode"="episode"))
gbb_full_df = left_join(gbb_half_df, bakers_df, 
                        by = c("baker_first_name"="baker_first_name", "series"="series")) %>% 
  relocate(series, baker_first_name, 8:11, episode, 4:7)
```